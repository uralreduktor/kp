# Тесты парсера данных торгов

## Запуск тестов

### ⚠️ ВАЖНО: Авторизация

Веб-сервер настроен с авторизацией. Для работы тестов необходимо:

1. **Для тестов через браузер (Playwright)**: 
   - Откройте браузер и авторизуйтесь на сайте
   - Затем запускайте тесты - они будут использовать сохраненные cookies

2. **Для тестов API напрямую**:
   ```bash
   # Установите переменные окружения с учетными данными
   export AUTH_USER=ваш_логин
   export AUTH_PASSWORD=ваш_пароль
   node tests/test-api-simple.js
   ```

### 1. Тест PHP парсера (прямой доступ к HTML)
```bash
php tests/test-parser-direct.php
```

Этот тест напрямую обращается к сайту B2B-Center и парсит HTML.
**Примечание**: Может не работать, если сайт требует авторизацию.

### 2. Тесты Playwright (через браузер)
```bash
# Установка браузеров (один раз)
npx playwright install chromium

# Запуск всех тестов
npx playwright test

# Запуск конкретного теста
npx playwright test tests/tender-parser.spec.js

# Запуск с визуализацией (рекомендуется для первого запуска)
npx playwright test --headed

# Просмотр отчета
npx playwright show-report
```

### 3. Тест API напрямую (Node.js)
```bash
# Без авторизации (если сервер позволяет)
node tests/test-api-simple.js

# С авторизацией
AUTH_USER=логин AUTH_PASSWORD=пароль node tests/test-api-simple.js
```

## Что тестируется

1. **API парсера** - проверка, что API возвращает правильные данные из ссылки на торги
2. **Заполнение формы** - проверка, что данные автоматически заполняются в форму torgikp.html
3. **Сохранение данных** - проверка, что данные сохраняются корректно после заполнения

## Ожидаемые результаты

При тестировании с URL:
`https://www.b2b-center.ru/market/priobretenie-reduktora-konveiera-ch-5a028-0-sztm-dlia-ao-mikhailovskii/tender-4242870/`

Ожидается:
- Номер торгов: `4242870`
- Торговая площадка: `b2b-center`
- Описание товара: `Редуктор 5А028-0 СЗТМ`
- Количество: `1`

## Устранение проблем

Если тесты не проходят:

1. **404 ошибка при загрузке HTML** - возможно, требуется авторизация на сайте B2B-Center
2. **Данные не заполняются** - проверьте консоль браузера (F12) на наличие ошибок JavaScript
3. **Парсер не находит данные** - проверьте структуру HTML страницы, возможно изменилась разметка

