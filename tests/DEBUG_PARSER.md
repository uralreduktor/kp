# Диагностика парсера B2B-Center

## Проблема

API возвращает `success: true`, но поле `items` отсутствует (`items: undefined`). Это означает, что парсер не может найти данные на странице B2B-Center.

## Шаг 1: Проверка логов парсера

Парсер теперь логирует подробную информацию. Проверьте логи:

```bash
# Вариант 1: Локальный лог API
tail -f /var/www/kp/api/error_log

# Вариант 2: Системный лог PHP
tail -f /var/log/php/error.log

# Вариант 3: Лог веб-сервера
tail -f /var/log/nginx/error.log
```

## Шаг 2: Что искать в логах

После попытки загрузить данные из ссылки, в логах должны появиться записи:

```
B2B-Center parser: URL=..., HTTP=200, Error=, HTML size=...
B2B-Center parser: Starting HTML parsing. HTML size: ...
B2B-Center parser: Found X rows with class 'c2'
B2B-Center parser: Row has Y cells
B2B-Center parser: First 5 cells: [...]
B2B-Center parser: Found item name at index X: '...'
B2B-Center parser: Final result - items count: X
```

## Возможные проблемы и решения

### Проблема 1: HTTP код не 200

**Симптомы в логах:**
```
B2B-Center parser: URL=..., HTTP=404, Error=...
```

**Причина:** Страница позиций недоступна (требует авторизацию или URL неправильный)

**Решение:**
- Проверьте, доступна ли страница в браузере без авторизации
- Возможно, нужно добавить поддержку cookies/session в парсер

### Проблема 2: Не найдены строки с классом 'c2'

**Симптомы в логах:**
```
B2B-Center parser: Found 0 rows with class 'c2'
```

**Причина:** Структура HTML изменилась или класс называется по-другому

**Решение:**
1. Откройте страницу позиций в браузере:
   ```
   https://www.b2b-center.ru/market/.../tender-4242870/?action=positions
   ```
2. Откройте DevTools (F12) → Elements
3. Найдите таблицу с позициями
4. Проверьте классы строк таблицы
5. Если класс другой, обновите селектор в `api/parse-tender-data.php` (строка 174)

### Проблема 3: Найдены строки, но данные не извлекаются

**Симптомы в логах:**
```
B2B-Center parser: Found X rows with class 'c2'
B2B-Center parser: Row has Y cells
B2B-Center parser: Item validation failed - ...
```

**Причина:** Структура ячеек отличается от ожидаемой

**Решение:**
1. Проверьте логи - там должно быть содержимое первых 5 ячеек
2. Определите, в какой ячейке находится "Наименование позиции"
3. Обновите индексы в `api/parse-tender-data.php` (строки 196-207)

### Проблема 4: HTML загружается, но пустой

**Симптомы в логах:**
```
B2B-Center parser: HTML size: 0
```

**Причина:** Страница требует JavaScript для загрузки данных (динамический контент)

**Решение:**
- Нужно использовать headless браузер (Playwright/Puppeteer) вместо cURL
- Или найти API endpoint, который возвращает данные в JSON

## Временное решение

Если парсер не работает, можно заполнить данные вручную:
1. Откройте страницу позиций в браузере
2. Скопируйте "Наименование позиции" и "Количество"
3. Вручную заполните поля в форме `torgikp.html`

## Следующие шаги

1. **Проверьте логи** после попытки загрузить данные
2. **Скопируйте логи** и отправьте для анализа
3. **Проверьте страницу** в браузере - доступна ли она без авторизации
4. **Проверьте структуру HTML** - изменилась ли она

## Отладка через браузер

1. Откройте `torgikp.html`
2. Откройте DevTools (F12) → Network
3. Вставьте ссылку и нажмите "Загрузить данные"
4. Найдите запрос к `parse-tender-data.php`
5. Проверьте Response - там должен быть JSON с данными
6. Если `items` пустой, проверьте логи PHP

