# üìç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è DaData API - –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –∞–¥—Ä–µ—Å–æ–≤

## –û–±–∑–æ—Ä

–í –ø—Ä–æ–µ–∫—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å **DaData.ru** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –ø–æ –±–∞–∑–µ –ì–ê–† (–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä, —Ä–∞–Ω–µ–µ –§–ò–ê–°).

### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- üîç **–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤** - –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)
- üìÆ **–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –∏–Ω–¥–µ–∫—Å—ã, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –§–ò–ê–° ID
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫** - debounce 300ms –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- üéØ **–¢–æ—á–Ω–æ—Å—Ç—å** - –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –ì–ê–† –æ—Ç –§–ù–° –†–æ—Å—Å–∏–∏

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoint

**URL:** `api/address-suggest.php`

**–ú–µ—Ç–æ–¥:** `GET`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)
- `count` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å. 20)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```
GET /api/address-suggest.php?query=–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –õ–µ–Ω–∏–Ω–∞&count=5
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "suggestions": [
    {
      "value": "–≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, —É–ª –õ–µ–Ω–∏–Ω–∞, –¥ 1",
      "unrestricted_value": "620000, –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª, –≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, —É–ª –õ–µ–Ω–∏–Ω–∞, –¥ 1",
      "postal_code": "620000",
      "country": "–†–æ—Å—Å–∏—è",
      "region": "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª",
      "city": "–≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
      "street": "—É–ª –õ–µ–Ω–∏–Ω–∞",
      "house": "1",
      "fias_id": "2763c110-cb8b-416a-9dac-ad28a55b4402",
      "fias_level": "8",
      "geo_lat": "56.838706",
      "geo_lon": "60.605494"
    }
  ]
}
```

---

## üì¶ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### API:
- **`api/config.php`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω DaData)
- **`api/address-suggest.php`** - API –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ –∞–¥—Ä–µ—Å–æ–≤
- **`api/address-validate.php`** - API –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤

### Frontend:
- **`pi.html`** - React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `AddressAutocomplete`
- **`js/cities.js`** - –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤ (–∑–∞–ø–∞—Å–Ω–æ–π)

---

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞ DaData

–¢–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ —Ñ–∞–π–ª–µ `/var/www/kp/api/config.php`:

```php
'dadata_token' => '0f1a2df340f6231ed018d99db0a69fedba08f819'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ —Ç–æ–∫–µ–Ω–∞:

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://dadata.ru/
2. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç–µ API —Ç–æ–∫–µ–Ω
3. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ `config.php`

### –õ–∏–º–∏—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞:
- **10,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å**
- **500 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω**

---

## üé® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ

### React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:

```jsx
<AddressAutocomplete
  value={formData.recipientAddress}
  onChange={handleAddressChange}
  onAddressSelect={handleAddressSelect}
  results={addressSearchResults}
  showDropdown={showAddressDropdown}
  onClose={handleCloseAddressDropdown}
  disabled={false}
/>
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è:
```javascript
const [addressSearchResults, setAddressSearchResults] = useState([]);
const [showAddressDropdown, setShowAddressDropdown] = useState(false);
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

```javascript
// –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
const handleAddressSelect = useCallback((address) => {
  setFormData(prev => ({ ...prev, recipientAddress: address.value }));
  setAddressSearchResults([]);
  setShowAddressDropdown(false);
}, []);

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (—Å debounce 300ms)
const handleAddressChange = useCallback((e) => {
  const value = e.target.value;
  // ... debounce –∏ fetch API
}, []);
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|----------|--------|
| `value` | –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (–∫—Ä–∞—Ç–∫–∏–π) | "–≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, —É–ª –õ–µ–Ω–∏–Ω–∞, –¥ 1" |
| `unrestricted_value` | –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (—Å –∏–Ω–¥–µ–∫—Å–æ–º) | "620000, –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª, –≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥..." |
| `postal_code` | –ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å | "620000" |
| `country` | –°—Ç—Ä–∞–Ω–∞ | "–†–æ—Å—Å–∏—è" |
| `region` | –†–µ–≥–∏–æ–Ω | "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª" |
| `city` | –ì–æ—Ä–æ–¥ | "–≥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥" |
| `street` | –£–ª–∏—Ü–∞ | "—É–ª –õ–µ–Ω–∏–Ω–∞" |
| `house` | –î–æ–º | "1" |
| `fias_id` | –§–ò–ê–° ID | "2763c110-cb8b-416a-9dac-ad28a55b4402" |
| `fias_level` | –£—Ä–æ–≤–µ–Ω—å –§–ò–ê–° | "8" (–¥–æ–º) |
| `geo_lat` | –®–∏—Ä–æ—Ç–∞ | "56.838706" |
| `geo_lon` | –î–æ–ª–≥–æ—Ç–∞ | "60.605494" |

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Debounce:
- **–ó–∞–¥–µ—Ä–∂–∫–∞:** 300ms –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
- **–¶–µ–ª—å:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API (1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N)

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞:
- **3 —Å–∏–º–≤–æ–ª–∞** - –º–∏–Ω–∏–º—É–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–æ–∏—Å–∫–∞
- **–¶–µ–ª—å:** –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —ç–∫–æ–Ω–æ–º–∏—è –ª–∏–º–∏—Ç–æ–≤

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ React
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–±–æ—Ä –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [DaData API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://dadata.ru/api/)
- [–ì–ê–† (–§–ò–ê–°) –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç](https://fias.nalog.ru/)
- [–¢–∞—Ä–∏—Ñ—ã DaData](https://dadata.ru/pricing/)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. **–¢–æ–∫–µ–Ω –≤ production** - —Ö—Ä–∞–Ω–∏—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞** - –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ `js/cities.js` –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤:

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ DaData:
- –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç
- –ú–∏–Ω—É—Ç–Ω—ã–π –ª–∏–º–∏—Ç
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–î–∞—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** 18 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è API:** DaData v4.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

